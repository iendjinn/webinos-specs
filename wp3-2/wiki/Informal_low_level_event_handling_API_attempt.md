Informal low level event handling API attempt[¶](#Informal-low-level-event-handling-API-attempt)
================================================================================================

Please, always refer to [the current WP 3.1 draft deliverable
spec](/wp3-1/wiki/Spec_-_Messaging)

Data types[¶](#Data-types)
--------------------------

     1 Event
     2 {
     3   // string denoting "informal" event type (e.g., as in DOM events) - valid strings are would-be identifiers (regexp: [_a-zA-Z][_a-zA-Z0-9]*) except the special string "any" 
     4   // this field does also determine the semantics of the payload field, if present
     5   type;
     6 
     7   // object representing the original sending entity (e.g., a Service object)
     8   // such object will contain an "hidden" address/globally-unique-ID and methods for communicating with it (to be provided by overlay networking/discovery)
     9   // for outgoing events it can be undefined, in which case the WRE will make sure it is interpreted as the "application address" at the other end
    10   source;
    11 
    12   // array of objects repsenting the original primary recipients of the event (as in source)
    13   to;
    14 
    15   // optional array of objects repsenting the original secondary recipients of the event (as in source)
    16   cc;
    17 
    18   // optional array of objects repsenting the original blind-carbon-copy recipients of the event (as in source)
    19   // if this is an ingoing event, it will either contain only one object representing the receiving entity if it was in bcc, will be undefined otherwise
    20   bcc;
    21 
    22   // string holding a hash of a certain serialization of the event object - to be used as a globally unique event ID
    23   // optional for not-yet-transmitted outgoing events, generated by WRE for ingoing events and transmitted events
    24   // for more information see the current draft deliverable spec
    25   id;
    26 
    27   // optional event object reference this event is a response to
    28   // for incoming events it will be undefined even if it was specified in case the WRE cannot find the original event object (e.g., it was garbage collected)
    29   inResponseTo;
    30 
    31   // optional Date object representing the moment in time in which the event is generated by the original event source
    32   timestamp;
    33 
    34   // optional Date object representing the moment in time past which the event is no more valid/meaningful
    35   expiryTimestamp;
    36 
    37   // optional boolean flag indicating that the event source wants to be notified by the event destination(s) about the result of the event delivery (default: false)
    38   notificationWanted;
    39 
    40   // optional boolean flag indicating whether the event should be stored and forwarded later if a destination is currently unavailable (default: false)
    41   cacheable;
    42 
    43   // optional boolean flag indicating whether the computation of the event ID should depend on the value of the Source field (default: false)
    44   sourceSensitive;
    45 
    46   // optional ordered array of EventForwarding objects representing the forwardings (may be partial) the event was subject to
    47   forwardings;
    48 
    49   // optional string containing arbitrary data (in alignment with the specified "type")
    50   payload;
    51 }
    52 
    53 EventForwarding
    54 {
    55   // these fields are the same as in Event, except that only timestamp is optional
    56   source;
    57   to;
    58   cc;
    59   bcc;
    60   timestamp;
    61 }
    62 
    63 EventCallbacks
    64 {
    65   // semantics to be defined (however I believe all should be optional)
    66   deliveredCB;
    67   sentCB;
    68   cachedCB;
    69   errorCB;
    70 }

Functions[¶](#Functions)
------------------------

     1 // Adds a listener callback to events of the specified type (Event.type) coming from the specified source (Event.source)
     2 //
     3 // Params:
     4 //
     5 //  cb:          callback function of type cb(event)
     6 //  source:      entity object or null meaning "any source" 
     7 //  destination: entity object representing some resource "controlled" by the application or null for the application itself
     8 //               (ISSUE: if there is an object representing the application itself, we could use null to match any destination, thus being consistent with source parameter)
     9 //  type:        type string or "any" meaning "any type" 
    10 //
    11 // Returns: String containing a (locally) unique identifier for the listener
    12 webinos.addEventListener(cb, source, destination, type);
    13 
    14 // Removes a listener
    15 //
    16 // Params:
    17 //
    18 //   listener: Listener string returned by webinos.addEventListener()
    19 //
    20 // Returns: nothing
    21 webinos.removeEventListener(listener);
    22 
    23 // Sends an event
    24 //
    25 // Params:
    26 //
    27 //   evt:            Event object - must not contain forwardings
    28 //   cbs:            optional EventCallbacks object
    29 //   expectResponse: optional boolean flag indicating whether a response to the message, other than a delivery notification, is expected (default: false)
    30 //                   (this helps the WRE to prevent garbage collection of events that might be referenced by responses)
    31 //   sync:           optional boolean flag indicating whether the call is going to be synchronous (true) or asynchronous (false) - (default: false)
    32 //
    33 // Returns: nothing
    34 webinos.dispatchEvent(evt, cbs, expectResponse, sync);
    35 
    36 // Forwards an event
    37 //
    38 // Params:
    39 //   evt:            Event object
    40 //   to:             array of objects repsenting the primary recipients of the forwarded event
    41 //   cc:             optional array of objects repsenting the secondary recipients of the forwarded event
    42 //   bcc:            optional array of objects repsenting the blind-carbon-copy recipients of the forwarded event (same rules as in Event)
    43 //   cbs:            optional EventCallbacks object
    44 //   expectResponse: optional boolean flag indicating whether a response to the message, other than a delivery notification, is expected (default: false)
    45 //   sync:           optional boolean flag indicating whether the call is going to be synchronous (true) or asynchronous (false) - (default: false)
    46 //   withTimestamp:  optional boolean flag indicating whether to include a forwarding timestamp (default: false)
    47 //   withHistory:    optional boolean flag indicating whether to include all the past forwarding history (default: false)
    48 //
    49 // Returns: nothing
    50 webinos.forwardEvent(evt, to, bcc, cc, cbs, expectResponse, sync, withTimestamp, withHistory);

Rationale[¶](#Rationale)
------------------------

-   DOM inspired, non-DOM (e.g., no bubbling, capture), DOM wrapping
    possible
-   function vs methods because of multiple recipients
-   expectResponse for lifetime magic of past Event objects
-   support for synchronous execution for synchronous API capable of
    remoting
-   forwardEvent for checking event modification and implementation
    purposes

Open issues[¶](#Open-issues)
----------------------------

-   Callbacks, exceptions and error code definitions (should be in
    alignment with all other Webinos APIs, consistency)
-   ID is only available after transmission....
-   Automatically ignoring messages (e.g., for canceling operations) to
    be supported at this level?
-   Amount of input validation?
-   (minimal) we could get better control of forwarding stuff if
    withHistory was something like an integer (number of forwardings to
    keep), but let's keep things as simple as possible... no?

